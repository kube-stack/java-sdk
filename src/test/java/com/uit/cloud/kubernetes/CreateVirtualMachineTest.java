/*
 * Copyright (2019, ) Institute of Software, Chinese Academy of Sciences
 */
package com.uit.cloud.kubernetes;

import com.github.kubesys.kubernetes.ExtendedKubernetesClient;
import com.github.kubesys.kubernetes.api.model.VirtualMachine;
import com.github.kubesys.kubernetes.api.model.VirtualMachineSpec;
import com.github.kubesys.kubernetes.api.model.virtualmachine.Lifecycle;
import com.github.kubesys.kubernetes.api.model.virtualmachine.Lifecycle.CreateAndStartVM;

import io.fabric8.kubernetes.api.model.ObjectMeta;
import io.fabric8.kubernetes.client.Config;
import io.fabric8.kubernetes.client.ConfigBuilder;

/**
 * @author wuheng@otcaix.iscas.ac.cn
 * @since  2019/5/1
 *
 * This code is used to manage CustomResource's lifecycle,
 * such as VirtualMachine
 */
public class CreateVirtualMachineTest {
	
	public static Config config = new ConfigBuilder()
			.withApiVersion("v1")
			.withCaCertData("LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUN5RENDQWJDZ0F3SUJBZ0lCQURBTkJna3Foa2lHOXcwQkFRc0ZBREFWTVJNd0VRWURWUVFERXdwcmRXSmwKY201bGRHVnpNQjRYRFRFNU1EY3hNVEV5TlRJeE1Wb1hEVEk1TURjd09ERXlOVEl4TVZvd0ZURVRNQkVHQTFVRQpBeE1LYTNWaVpYSnVaWFJsY3pDQ0FTSXdEUVlKS29aSWh2Y05BUUVCQlFBRGdnRVBBRENDQVFvQ2dnRUJBTVFICjVWNGFUWlRzWGZoTUM2RGk4a0tRR25TNDgwcmtWWFplVzRPMGJUci96ZEYxanA1eWNFVFVMSi9EazNkQ3F1SzgKVU8zWDR5aldCdFkwYjhta2FTd215Q25uNGs4TGtuQ1JxTkZSZCs2dHl0ZjBJa3lKckYzY3lXZWM0NU9hbGNjcgpsNjlJYXRmdy9kRmgyZm40STFYZGVmdUtwYm11L3hXOVNSWGVvcHYyUS9VT09yWlJ4RFJ6MGtlQUNYQk5sN1NhCmpBaTJZLzMwNHdOREJnelNRbHdvTHBKempoVlBaU3BHYjdYdDFRdGg5U0t6VVVvM2hGMEh3dmxOdnNuaW9mU3QKRXhLdHhEaXIveG9TZmRROG9Ib1I2TFprczdCRjdtdXZHdS93L2FiclIvdzlXdURkS2JqT0FjanBzcDdrRXNHaApmanhVTnQxWHBSVVBmb1RKT2o4Q0F3RUFBYU1qTUNFd0RnWURWUjBQQVFIL0JBUURBZ0trTUE4R0ExVWRFd0VCCi93UUZNQU1CQWY4d0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFId1ZlQmwwTk9maDNuSjNSeE12bzFZd05wc3oKZUh2OU5TVTlvR2VObGdPeVpMdkNYU3VRaUJZdjc3TUJuZHBVUWhIdkpIYk0xS2w3ZUpnMHJVenIvQjVnbE12awpoRUN2U3hVbGlvYlBqUU42SnhnMG5zWE9mNVZXd1l0cTRJSi8rcXoyYVNRQXZCUkt6Q3F2VHJWN242bTVmZWVICnQ0bnlwaHpOWGdlMERWaHUxUHhmQXpXS01NYit2MHRSbXB6ZW5OWnJSWWFnOWFoUU92OXRJVzhqbjZtM2YwNFYKd2RxekZUVVNzNDlDQzg5R2MwSU13aURxVk1uOW5EQS9ZOVRRdy9JNjZSQnREUTJadXhzRkRYUjJpOFFsWUkvagpleVgyNHJDMFZuMEl1dm5tbFZQa2prR25QSDJPN3I5VUlVb2pYNG5FbytrV1IrYzdpMkJqZE5veUFtZz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=")
			.withClientCertData("LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUM4akNDQWRxZ0F3SUJBZ0lJRy9YamwzNGNuNkl3RFFZSktvWklodmNOQVFFTEJRQXdGVEVUTUJFR0ExVUUKQXhNS2EzVmlaWEp1WlhSbGN6QWVGdzB4T1RBM01URXhNalV5TVRGYUZ3MHlNREEzTVRBeE1qVXlNVFZhTURReApGekFWQmdOVkJBb1REbk41YzNSbGJUcHRZWE4wWlhKek1Sa3dGd1lEVlFRREV4QnJkV0psY201bGRHVnpMV0ZrCmJXbHVNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQTNwNE1UOFIrNkNEWElHdGMKcXpRdzVMUkxEa1BSWGxpbEl0UGJsMlcyek9lSHlQWG9pb1hXL0VZOEZSNi9OVGJ4YTE4UHFvRUVoOEdJeEQwZwp3OFJJZjlpa1VEYnoyVlZDR0txdVoxSTcwaTExUWpkdFdOTnZqUXRZNmVNaDNPc3plSnlUbDY1V3EzcXdlNDZMClJ2Rk8yN0dhbHZaWUdJb2FuNm9pRS80WFN0M0tBbkFIRURrYWxyaFNZb0NSSGZVeVlNSjNLWXVVL0xjZm9NaTYKTXh1N01qZ2tUSFlGeWFBbTA0aTE4bGtwT0pBVjdnbVhVOThhenJPMmtBRlFBOFJycDI1clUrNEFvdEJXSUY2dApzVldPU1liSXpqdkJzNnMwZTh5dUZSSGlrZVlNK0VyNlBQam9tTE42cSs0dmlhL1ErVmpESXRtUjJaQ05mOXR1CmNweXBmd0lEQVFBQm95Y3dKVEFPQmdOVkhROEJBZjhFQkFNQ0JhQXdFd1lEVlIwbEJBd3dDZ1lJS3dZQkJRVUgKQXdJd0RRWUpLb1pJaHZjTkFRRUxCUUFEZ2dFQkFFUm1mTVc3NjV0YWRORWJDWkExYm9pQkVYWDRWZUpMVlZvZwpBaEZsZjU1bFVvZmtFNnNodzhUWnFEejVaU0IwWS9GZyswOTBPb0REN291T2wzUVRmN2V2eVZoWFBzS29rMDVlCnZIbmplR1dEeXVxZW9EdVAvT1lFV0U3UzZZSHRUOVd3WkloNHorMTNSOTdMNURHT1VvS041bmMyUHMvVHNTWDYKMWxYNGhHdmtzZjFsN1R4YnpuSmZrSGtWa1pGaGxCWGJZSE8wQmhmemdOMzd0TjBKK0N6bWdvRStiVGFGbUtVUApOUFZ4UzExbm9CSy90MVdqdU1FN1VoVDBONWhTMXVzc2ZDQTEra3BiVklSOHlhdDc3dkMyeEhtWElCaEpldll2CnRocDdkNUI0OGU3NG02bEYyWkVsUlBzNUpzRyszRHdSUGJMYTZDMmFscHhRM3YvcXNuaz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=")
			.withClientKeyData("LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBM3A0TVQ4Uis2Q0RYSUd0Y3F6UXc1TFJMRGtQUlhsaWxJdFBibDJXMnpPZUh5UFhvCmlvWFcvRVk4RlI2L05UYnhhMThQcW9FRWg4R0l4RDBndzhSSWY5aWtVRGJ6MlZWQ0dLcXVaMUk3MGkxMVFqZHQKV05OdmpRdFk2ZU1oM09zemVKeVRsNjVXcTNxd2U0NkxSdkZPMjdHYWx2WllHSW9hbjZvaUUvNFhTdDNLQW5BSApFRGthbHJoU1lvQ1JIZlV5WU1KM0tZdVUvTGNmb01pNk14dTdNamdrVEhZRnlhQW0wNGkxOGxrcE9KQVY3Z21YClU5OGF6ck8ya0FGUUE4UnJwMjVyVSs0QW90QldJRjZ0c1ZXT1NZYkl6anZCczZzMGU4eXVGUkhpa2VZTStFcjYKUFBqb21MTjZxKzR2aWEvUStWakRJdG1SMlpDTmY5dHVjcHlwZndJREFRQUJBb0lCQUZ2RXV6Nkd1ZW5tMzhlMQplbFg1QmM3Qm84OFZsZEZXcVh4WjZVUFg0aXRGcG12cE14c25ZU0JOczZiaExlRTU3UHRlREk4MDhERW1Uc0xXCmtCTWpidCtFNXZkS0wrdC9nZWU1Tkh2VEltWFo1MlNNaEw4QktoTHlnb3luM09XODcxTGcrTmFtUDRRZzUyK0gKcTFKclZ4NnBjQmliSkdXNVNKQlpDZ05EMDBaQXNrZ2trMENjZ1VlR3ExNmRxSkxxNFVhSFRNNjM5aUtDNW5ZZwpRK2dLTDNuejNsalZOYzBWVk5RYlk3aG1yNEpLYmgzWUErY0I5c2ZwNGZhWlZVc2lONVhWcUU1MHBra0xtSzkvCnRJbmhOYmYwSHYvaGVvRE1DTWZJdWkyOVZXWnNYek0rSWZsVFFSN2ZIY1h2aGVVWTkxaStsbmZiNTlMNVFrMXMKR2UxU0tBRUNnWUVBL055ZVordDFEcmIvdkhaOXhFRktFOXJmdzQzeGYwZHIrbXYrQlhEZmtlb1dmK2V6RmJuWApTeXd1Szh3Q2tvNWtVbjRmdHZtRG9tWWtiUHdseTRyZTkzK3pmWUlORlRRQUhpUWp2NGtkcmliU2s2QzBxWjAxCjBGVnBvYTVoeDVCcTRWL0JuSmRQNG83ZFNiWUNVeXgraFJBMkxjQ2JXNzFPeFljaU9KQ3hydjhDZ1lFQTRXRlcKamdtMGZQQ00rQjRjRFRkejBQV0xNRlE0N2gwUU8vQkdRSXMzbmcrZm9XU0FGc2I2OHNMZW1OSUVwR0JrZHBENwpyS2x4cytZcVh0L3Z1SlhJaTZla2dmdkF1NHR6VnJ2S1pRSGhuRzNQcU9Xb2dKcWFtUE9CbEgwMUNvVWtGelVhCmFTekdRd3I0dHhkTlQrMENWSFh0bWhrMzdDSW8zZEVFQ2IvWGhZRUNnWUVBdDFIWEFlNUJZbGFuMTJGc1VwRW0KL0hnTkRBQm5XZWhVenl2bDhObmhMQzh5K3Ezbk50UVIwdTBIMkRiQ2txL3E2YWVJcEtZR21nRkZYVUg4d0xGQQpidHpGS3pQUytsRkYySlJJMm42MDV1SThma3pmVGF5dExBb1FWK2hOK1ZtcE14V3lEeTNmKzVlcHROdmdtWjVEClo0TFdWSnN6eHZIYkh2ZVdocjNZSTg4Q2dZQjVKZlY4ekVLMGxpbHdoZDdXUytSNWdrT2JhdXBmTkVneHIrcFQKYjRJcCtJUDZJU2VwRnJSMkljRzlxOGJMQlBWN3RsdFNhSkt4L1JyeGZMWkRKbUJ5a1Y2Z2NFOGRnTXd5NXliWQpQTGFsZTNHUWZFS2pQbmV6bDlFam5Gb1NtWmJZMHJhcnFtRzRVQUY1aVpFSlVZRmJIVGpuQ0g5Qzh1bThza25WClk4WGFBUUtCZ0hSbStTZVJ5UHZBRFFuZGs1Sm1HRFNHRkFwSkdqRUw2dHVncHpKTTZydytIQjk3M2VuM0lLNHgKdEg4UXk4N1N5aUpRVHNqeWxaZTZqRFRJZVF0YVRhUVZJSUYzWDYxa2FzNy85eVJZeEh5aGJOWGllTnJVMnFOZgpjdWd1Y2cyZ1Fwd2tmcWUvR3FSL2xZU0JCWDZ1bW9ub2RHMTdWK2hSR3dTOXl5NzNhNFNDCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0tCg==")
			.withMasterUrl("https://10.25.0.140:6443")
			.build();
	
	public static void main(String[] args) throws Exception {

		ExtendedKubernetesClient client = new ExtendedKubernetesClient(config);
		boolean successful = client.virtualMachines().create(createAndStart());
		System.out.println(successful);
	}
	
	
	public static VirtualMachine createAndStart() throws Exception {
		VirtualMachine vm = new VirtualMachine();
		vm.setApiVersion("cloudplus.io/v1alpha3");
		vm.setKind("VirtualMachine");
		ObjectMeta metadata = new ObjectMeta();
		metadata.setName("vm1");
		vm.setMetadata(metadata );
		VirtualMachineSpec spec = new VirtualMachineSpec();
		Lifecycle lifecycle = new Lifecycle();
		CreateAndStartVM createAndStartVM = new CreateAndStartVM();
		createAndStartVM.setVcpus("2");
		createAndStartVM.setMemory("1024");
		lifecycle.setCreateAndStartVM(createAndStartVM );
		spec.setLifecycle(lifecycle );
		vm.setSpec(spec );
		return vm;
	}
	
}
